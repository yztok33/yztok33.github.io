![d9cMjbeQm2dn8hBaW5jG](https://i.loli.net/2020/08/08/plw5njSkhua8HFQ.jpg)

# 羊毛党链路分析

------

## 羊毛党分类

1. 刷单刷票类：利用该动作获得利益，例如淘宝刷单。
2. 任务类：通过做特定任务获得奖励，例如注册、拉新、绑定等。
3. 黄牛党：利用信息不对称以及技术优势，对某些资源进行垄断，然后转手获利。
4. 漏洞研究类：研究活动规则的漏洞，可能加上一点技术。可能平台也需要这些活跃用户，例如信用卡养卡，是一种互赖型的薅羊毛。
5. 黑客类：利用平台漏洞，获取利益。这类活动基本是违法行为。

另一种分法：

1. 初级羊毛党多是一些“爱占小便宜”的散客，他们常常是零散进行薅羊毛活动。

2. 中级羊毛党常通过一些羊毛群获得相关资讯 ，积极参加薅羊毛活动，开始呈现出一种松散的组织形态。

   初级和中级羊毛党都属于第一代羊毛党，是“业余玩家”。

3. 第三类是“专职羊毛党”，他们是工具化的“职业玩家”，属于第二代羊毛党。 一方面，他们会使用代理IP让反欺诈系统无法判断它的位置;另一方面，他们还使用大量的虚拟号自动注册。甚至有专门的收（打）码平台帮你输入验证码，费用从每次1毛到2.5毛不等。

4. 最高级的第四类是“团长羊毛党”，属于第三代羊毛党。他们是羊毛党中的“正规军”，有组织、有纪律，利用手中的羊毛联盟等资源进行刷单刷量，获取经济效益。 有一家团长羊毛党公司，凭借几千万个苹果账号刷单规模，他们可以决定每日App store中游戏的下载排名。一个月仅App刷量业务就可以达到两三个亿的流水，收入非常可观。

   ![月入上万的羊毛党，是怎样薅互联网公司的羊毛？_财经头条](https://i.loli.net/2020/08/09/xJ9RcrTqd37SVib.jpg)

   ![大数据挖出：谁在薅互联网金融的羊毛|DT](https://i.loli.net/2020/08/09/Hms4bfQyVDxC8ZB.png)

图中红点代表了一个手机设备，其他颜色的则代表了不同的元素。从图中可以清晰地看出，这一个手机设备通过多次刷机形成了19台虚拟设备，这19台设备注册了19个账号完成了19次薅羊毛行动的数据轨迹。这是通过设备物理地址来判断羊毛党的案例之一。

其次，App内的点击行为也可以是判断依据。由于羊毛党都是机器操作，它们在App中浏览优惠券并点击的时间间隔要远小于普通用户，而且往往一旦抢到红包就再也不登录了。通过这些特点我们可以找出一些疑似羊毛党。

此外，注册和交易时间间隔，单个用户参与活动频率，交易频次，提现频率、营销返现、刷订单等行为，都是羊毛党反欺诈评分模型的判断依据。通过这个模型，公司就可以将所有用户打分，找出不同类型的羊毛党。

![img](https://i.loli.net/2020/08/09/rbif2U8zcAHWFxy.png)

## 黑灰产业链

![img](https://i.loli.net/2020/08/24/8XfVzSnx7qIceAE.jpg)

**1. 手机卡商**

手机卡商，属于整个产业链最上游的群体。数量众多的卡商们，为各大接码平台源 源不断地提供手机卡，也就是风控领域中常说的“虚假号码”。

“虚假号码”并不是“虚拟手机号”(由虚拟运营商负责发行和管理的手机号)，“虚 假号码”泛指所有用于代替他人接收验证码的手机号。绝大部分虚假号码，没有经过 实名制登记，存活时间有限，超出运营商规定的实名制期限，就会被强制停机，然 后变成空号进行回收，再继续投放市场。也有部分虚假号码，是经过实名制登记 的，可以长期使用，但随着时间的推移，这些号码被使用的次数越来越多，过往的 风险行为很容易被识别出来，进而被标记为黑名单。

**2. 接码平台**

接码平台一般会提供客户端、API，甚至手机客户端，服务端会根据预先设置好的短信模板对短信内容进行自动匹配，提取出其中的验证码信息，为羊毛党提供了极 大的便利。 接码平台的 API，能够对接到自动化脚本和自动化工具中，实现批量化注册。

**3. 打码平台**

验证码（Captcha）是各个网站、APP常见的功能模块。 在网络黑产中，不法分子窃取网站数据库后，需要确认帐号对应的密码是否正确， 将有价值的数据通过验证的方式筛选出来，这一过程黑话叫“晒密”，意即撞库。而 “晒密”最核心的障碍就是互联网公司设置的验证码安全体系。每天面对数以亿计的 “晒密”需求，黑产分子不可能人工逐个识别，而是需要提高“晒密”效率，批量识 别。“打码平台”即是提供批量自动化识别各类验证码的专业服务平台。

**4. 改机工具**

改机工具，是通过劫持系统函数，来对设备信息进行篡改的技术手段。 Android 或 iOS 设备中，都提供了各种接口，用于获取设备的基本信息，比如设 备标识符IMSI，IDFA/IDFV。而改机工具能够从系统层面劫持这些接口，当APP调 用这些接口来获取设备的各项参数时，获取到的，都是改机工具伪造出来的数据。 如果凭借设备参数来判断设备的唯一性，改机工具每次生成新的参数，就会被识别 为一台新的设备。

**5. 按键精灵**

移动端的按键精灵能够记录用户的触摸轨迹和输入操作。早期的按 键精灵，通过录制用户的触摸轨迹来完成，发现到今天，大部分按键精灵，已经可以通过编写脚本来实现了。

**6. 群控系统**

群控系统，是模拟器作弊的升级手段。模拟器作弊和群控系统，都是为了打破越来 越多的针对设备维度的限制技术而产生的。区别在于，群控系统都使用真机来完 成。设备指纹技术的产生，让我们可以通过多种方式，来识别设备都否是模拟出来 的。设备群控，应运而生。

**7. 开发者**

开发者在整个黑色产业链中，扮演者非常重要的角色。数量众多的开发者，不断地 在给整个黑产军团提供大量的自动化工具、作弊工具、脚本、插件，大大提升了黑 产的作业效率。

## 运营手段防范

对于运营活动来说，羊毛党最常导致的问题就是运营成本失控、数据样本失真、垃圾账号混淆、公正性失信等等。其中运营成本失控，如果把握不好，拖垮公司都是有可能的。而数据统计的失真，也导致无法清晰判断后续的运营策略。羊毛党的蜂拥而至，也会降低真实用户的积极性这忠诚度，榨干平台。

要想防范羊毛党，最主要的还是控制利益的诱惑，避免直接利益，比如红包话费等。而对于优惠券之类，用户需要购买才能使用的，诱惑就没那么大了。除非是五折以上或者是大额现金券。此外，购物也需要填写明确的收货地址及其他个人信息，羊毛党会相对谨慎一些。

因此，在制定营销活动时，必须制定完备的业务规则，必须要有相应的活动门槛和限制，例如：

- **用户群体限制**：定义哪些类型的用户能参与活动，指定清晰的分界线。对于特定的活动，可以适当提高参与门槛，比如 V2 以上会员可以参与，有过购买记录的可以参与等等。这种主要针对特定群体会员做运营，对于被排除在外的用户，体验就没那么好了。

- **客户端版本限制**：定义哪些 APP 或小程序版才能参与，比如：拉新活动要求必须使用最新版 APP 注册才给奖励。

- **次数/上限限制**：明确定义账户级、设备级、实名信息级能参与活动的上限和参与活动的频率等，才能有效防范羊毛党。比如每个账号的上限，每日活动预算的上限。活动规则中也要明确说明，如果发现有人通过刷单刷票等形式违规操作，平台有权取消其参与资格或相应奖励。这样对于异步发放的奖品，也可以在发放之前检查一下数据，筛掉可疑用户。

  最后，对于所有活动的数据，在开发之前就要明确提出需要监测哪些数据。不然活动都已经跑起来了，没有预先埋点的东西肯定是拿不到的。作为运营对数据一定要极其敏感，如果有暴增的用户量或者参与量，就要小心是不是有羊毛党来袭，而不是光顾着乐。

## 技术手段防范

以下是腾讯云的防刷接口对风险类型的定义：

![科普 | 拒绝羊毛党：运营同学必看的防薅羊毛技术完全解读](https://i.loli.net/2020/08/08/QyX2a835WvBb7qZ.jpg)

通过技术手段薅羊毛，最常见的就是高频刷接口，恶意注册账号，撞库等。而这类羊毛党，一般会大量养卡，或有很多虚拟的打码平台，可以提供手机号+验证码服务。有的可能还会拥有大量动态IP地址，海外服务器，以及批量的身份证等。还有专业的设备，称作“猫池”、“卡池”。对于移动端的业务，许多这类公司还购入大量实体手机，再通过软件批量控制，称为“群控”。对于这种羊毛党和黑灰产，传统的防护手段一般有三种：封IP，封用户，增加验证码。下面分别进行讲解：

- **封禁IP**：这里要注意，封禁 IP 或 IP 段是有风险的，许多公司对外的出口 IP 都是统一的，如果全公司很多人同时访问某网站，就可能被误伤。共享的 WIFI，某些移动基站也可能是有固定的出口 IP，所以最好轻易不要封禁 IP 或 IP 段。
- **封禁用户**：我们可以根据某些特定的规则，筛选识别出一批用户，对其进行一些限制。可以采用黑名单机制，或者用户风险分级、信用分级等等。然后再根据黑/白名单，或用户等级限制特定的行为，比如完全拒绝服务、限制某些功能、限制大奖等等。
- **增加验证码**：验证码的主要作用就是区分操作者到底是人还是机器。
- **系统限流**：限流只能一定程度上缓解，或者说让风险可控。主要是防止恶意请求流量、恶意攻击，或者防止流量超出系统的峰值，破坏系统。
- **离线数据分析**：如果活动已经在进行，或者活动已经结束，但是总感觉不对劲，这时候就要采用离线数据分析的方法，仔细辨别是否有羊毛党的存在。除了活动必须的数据之外，如果想更深入地分析用户行为，那么在需求设计阶段就要想好，希望记录哪些行为，便于后续分析。如果系统没有提供这些能力，显然也没有相关的数据可以分析了。

## 综合风控方案

完整风控解决方案，不仅要考虑用户体验，同时又要兼顾效果，需要考虑很多方面。因此有很多大小公司都专门提供了这方面的解决方案。比如腾讯、阿里、网易等等，此外还有许多提供这种业务的公司，搜索“防薅羊毛”就会出现很多。这些解决方案的基本原理与上述技术无异，只是数据基数更大，再加上机器学习和大数据分析，可以更加准确识别出恶意用户和黑产用户。

以下内容来自网易易盾《全链路风控解决方案深度解读》中提到的风控服务，不代表本人观点，仅供参考。

**事前预防：**通过数据采集收集用户侧信息、通过业务规则来限定参与活动的门槛、通过身份核验来确认用户身份等手段，防止风险事件的发生。

**事中检测处置：**通过实时在线的手段来检测风险，并做相应的风险处置，防止风险事件的发生。

**事后分析回馈：**基于长周期的离线数据分析，计算用户侧、设备侧、IP侧、业务侧的各种风险特征，并作用于事前风控和事中风控。

**1. 事前预防**

事前预防主要有三个层面的事项：数据采集、业务规则、身份核验。

**a）数据采集**

在业务活动的各个阶段，都需要埋点采集数据，主要有设备指纹、操作行为、网络数据、业务数据、第三方数据等。采集的数据主要用于事中的风险监测和事后的离线分析。

**b）业务规则**

在制定营销活动时，必须制定完备的业务规则，必须要有相应的活动门槛和限制，例如：

- **用户群体限制：**定义哪些类型的用户能参与活动，指定清晰的分界线。比如：电商大促经常出现的神券，可以限制账户等级>3、年度内购物次数>2才能领取等等。
- **APP版本限制：**定义哪些APP版本能参与，比如：拉新活动要求必须使用最新版APP注册才给奖励。
- **参与次数限制：**明确定义账户级、设备级、实名信息级能参与活动的上限和参与活动的频率等。

**c）身份核验**

身份核验主要是为了确保是用户自己来参与活动，主要手段包括：手机短信校验；验证码校验；密码校验；密保问题校验；本机校验：校验手机号对应的SIM卡是否在当前设备中使用；实名认证，有三种：1）身份证OCR校验；2）身份证OCR、人脸校验；3）身份证OCR、活体检测；个人信息。

**2. 事中检测处置**

事中检测主要依赖人机识别、风控引擎、风险处置三个手段。

**a）人机识别**

人机识别主要区分是人，还是机器自动化的行为。客户端与后端的数据交互过程中，增加如下的数据保护手段，一旦发现数据有问题，则都是机器行为。数据合法性校验；数据加解密；数据篡改检测。

**b）风控引擎**

事中检测的核心工具就是风控引擎，风控引擎主要的工作是识别风险，一般的风控引擎都需要如下几个功能：

- **名单服务：**建立黑、白、灰名单；
- **画像服务：**建立基于IP、手机号、账户等层级的画像服务；
- **指标计算：**一般包括高频类统计、求和、计数、求平均值、求最大值、求最小值等等；
- **风控模型：**基于采集到的数据，建立风控模型，比如：**设备模型**、**行为模型**、**业务模型**等；
- **规则引擎：**最终的风控数据进入规则引擎，由规则引擎判断是否存在风险。风控运营需基于业务建立各种风控规则，以识别风险。

**c）风险处置**

识别到风险之后，需要对风控进行处置，处置手段一般有：

- **二次校验：**比如，正常用户无需二次校验，有风险的用户需再次校验手机短信等；
- **拦截：**拒绝当前业务操作；
- **降低奖励：**比如，正常用户的奖励金是1元，风险用户奖励金是0.01元；
- **拉黑：**直接进黑名单；
- **名单监控：**进灰名单监控；
- **风险审核：**进入人工审核，比如：电商场景的订单业务，一般嫌疑类风险订单，都会安排人工审核。

**3. 事后分析回馈**

事后主要是做离线分析，分析结果可作用于事中实时检测和事前预防。对于T+N的业务（比如：拉新奖励金提现），离线分析之后，若识别出风险，也可以做拦截（拒绝此次提现）。

离线分析主要有几个方面：

- **离线指标：**基于长周期、大数据的离线指标计算；
- **关联分析：**基于前后关联业务、关联数据做关联分析，识别风险用户、风险操作；
- **复杂网络：**基于用户数据、设备数据、网络数据、业务数据，建立复杂关系网络，基于数据与数据之间的关系，来识别风险；
- **模型训练：**基于机器学习、深度学习技术来构建业务模型、设备模型、行为模型，或文本类模型（异常地址检测、异常昵称检测）等；
- **名单库：**通过离线分析，积累、沉淀各种名单库；
- **数据画像：**基于离线分析，对账户、IP、设备、手机号等构建数据画像。

**4. 全链路布控**

全链路风控解决方案另一个非常重要的过程是：全链路布控。若只是构建了全链路风控模型（工具），未做全链路部署，那也是大材小用。

全链路布控主要要做到：

**多业务布防：**在业务的各个环节都需布控防刷手段，一般的营销活动都需先注册、登录，再参与营销活动。所以，可以在注册、登录、营销活动各个环境都布控风控检测。

**联防联控：**前置业务为后置业务产出事前特征，避免后置业务风控检测冷启动；后置业务为前置业务提供事后特征，比如：准实时、中长周期的风险特征。

**5. 第三方解决方案的弊端**

第三方解决方案的弊端就是对系统的侵入，需要我们在自己的系统里嵌入许多外部代码。那么带来的风险就是，系统数据全部开放给外部，用户数据风险，业务经营数据风险，系统可用性风险等。一旦外部系统出现问题，可能导致我们自己的系统不可用，或者数据泄漏。如果不能接受这一点，或者无法信任第三方，或者公司政策不允许，那就无法使用这种服务。

附陌陌风控引擎架构图：

![architecture.jpg](https://i.loli.net/2020/08/09/csjL8DzhQJVCeB9.png)

## 总结

最后，综合总结一下全文的梗概，如果前面都没仔细看的话，那么只看这里就可以了。

**（1）适用范围**

主要针对自动化薅羊毛的防御。

**（2）业务逻辑设计**

拉新活动要小心（拉新送、注册送、关注送、新用户立减、日常打卡、签到、获得积分、积分兑换、抽奖）。

**（3）系统设计**

**接入层：**Nginx，限制频率，IP 黑名单（代理IP识别）；

**应用层：**redis，漏桶，令牌桶算法；

**接口层：**访问控制，防重入 token（token是用户一次操作的唯一标识），模糊的响应迷惑恶意请求；

**业务层：**验证码，黑/白名单机制（大数据），设备指纹，行为数据，全链路布控；

**界面层：**提高破解门槛，防自动化（按键精灵等）；

**数据分析：**分析历史作弊数据，优化活动奖励，采用堵不如疏的策略，与其强硬的一刀切，不如提升攻击成本，减少获利；机器学习，大数据反作弊平台，GCN、Node2V、Louvain、GAN、GBS、LSTM等模型。

以上，就是防范羊毛党相关技术的全部内容。

参考地址：

【1】http://www.woshipm.com/operate/3150544.html

【2】https://github.com/momosecurity/aswan

【3】https://blog.csdn.net/zgjdzwhy/article/details/72978488

【4】https://www.shangyexinzhi.com/article/1586834.html